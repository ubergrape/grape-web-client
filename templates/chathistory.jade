.history
	each lines in groupHistory(history)
		- var first = lines[0]
		.chatline(key=first.id, data-id=lines[lines.length - 1].id)
			aside.avatar
				img.image(src="#{first.author.avatar}",width="20",alt="#{first.author.username}")
			.content
				div.author= first.author.username
				each line in lines
					time.time(datetime=line.time.toISOString())= strftime('%H:%M Uhr', line.time)
					if line.actor && line.actor.image && line.actor.image.url
						a(href=line.actor.url, class="actor")
							img(src=line.actor.image.url, width=16, height=16, alt=line.actor.name)
					if line.container
						a.container(href=line.container.url, class=line.container.type)= line.container.name 
					if line.title
						.text= line.title
					if line.text
						.text= html(marked(line.text))
					if line.container
						a.container(href=line.container.url, class=line.container.type)= line.container.name 
						if line.branch
							span.branch= line.branch
					if line.content
						.content= line.content
					if line.attachments
						//- process attachments/uploads
						each attachment in line.attachments
							if attachment.type.indexOf("image") == 0
								//- attachment is an image
								a(href=attachment.url)
									img(src=attachment.url, alt=attachment.name)
							else
								//- any other file
								a(href=attachment.url)
									attachment.name
					if line.objects
						ul
							each obj in line.objects
								li(class=obj.type)
									if obj.sha
										a(href=obj.url)= obj.sha 
									if obj.name
										a(href=obj.url)= obj.name 
									if obj.content
										.content= obj.content
									if obj.summary
										.summary= obj.summary
									if obj.author && obj.author.username
										span.author= obj.author.username
